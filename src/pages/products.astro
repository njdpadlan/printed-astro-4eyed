---
import ProductsHero from "../components/Products/ProductsHero.astro";
import FeaturedProducts from "../components/Products/FeaturedProducts.astro";
import MoreProducts from "../components/Products/MoreProducts.astro";
import PromoProducts from "../components/Products/PromoProducts.astro";
import Layout from "../layouts/Layout.astro";
import fetchApi from "../lib/strapi";
import fetchPageData from "../lib/pagedata";


const pages = await fetchApi({
  endpoint: 'products', 
  page: 'ProductPage',
  wrappedByKey: 'data',
});

// http://localhost:1337/api/products?populate[ProductPage][populate]=*

//fetch page data for products page
const productPage = pages[0];
const pageData = productPage?.ProductPage || [];

// fetch productshero components
const heroData = pageData.find(pd => pd.__component === "producthero.product-hero") || {};
const {productHeroHeader, productHeroText} = heroData;


const { productHeroImage: {
	url: productHeroImage
}} = heroData;


//fetch featured products components
const featuredproductData = pageData.find(pd => pd.__component === "productsfeaturedproducts.products-featured-products") || {};
const {
    featureProductsHeader, 
    pressuresealTitle,  
    pressuresealBtn,
    linerlessTitle,
    linerlessBtn,
    integratedformTitle,
    integratedformBtn
    } = featuredproductData;

const { pressuresealImage: {
	url: pressuresealImage
}} = featuredproductData;

const { linerlessImage: {
	url: linerlessImage
}} = featuredproductData;

const { integratedformImage: {
	url: integratedformImage
}} = featuredproductData;

// fetch  more products component
const moreProductsData = pageData.find(pd => pd.__component === "moreproducts.more-products");
const { 
    moreproductsHeader, 
    lasercutTitle, 
    highqualitylaserTitle,
    lasercutText,
    partsText,
    featuresText,
    customsizesText,
    snapsetTitle,
    durableTitle,
    multipartText,
    snapsetpartsText,
    commonuseText,
    fieldserviceText,
    continuousTitle,
    reliableTitle,
    continuousText,
    continuouspartsText,
    idealforText,
    accountingText,
    customenvelopeTitle,
    deliverbrandfirstTitle,
    daytodayText,
    regularText,
    availableoptionsText,
    regularwindowText
} = moreProductsData;

const { lasercutImage: {
	url: lasercutImage
}} = moreProductsData;

const { snapsetImage: {
	url: snapsetImage
}} = moreProductsData;

const { continuousImage: {
	url: continuousImage
}} = moreProductsData;

const { customenvelopeImage: {
	url: customenvelopeImage
}} = moreProductsData;

//fetch promo products components
const promoProductsData = pageData.find(pd => pd.__component === "featuredpromoproducts.featured-promo-products");
const {featuredpromoTitle, featuredpromoText, featuredpromoBtn} = promoProductsData;

const { featuredpromoImage: {
	url: featuredpromoImage
}} = promoProductsData;


---

<Layout>

    <ProductsHero {productHeroHeader} {productHeroImage} {productHeroText} />

    <FeaturedProducts 
    {featureProductsHeader} {pressuresealTitle} {pressuresealImage} {pressuresealBtn} 
    {linerlessTitle} {linerlessImage} {linerlessBtn} 
    {integratedformTitle} {integratedformImage} {integratedformBtn} />

    <MoreProducts {moreproductsHeader} {lasercutTitle} {lasercutImage} {snapsetImage} {continuousImage} {customenvelopeImage}
    {highqualitylaserTitle} {lasercutText} 
    {partsText} {featuresText} 
    {customsizesText} {snapsetTitle}  {durableTitle} {multipartText} {snapsetpartsText} {commonuseText} {fieldserviceText} {continuousTitle} 
    {reliableTitle} {continuousText} {continuouspartsText} {idealforText} {accountingText} {customenvelopeTitle} {deliverbrandfirstTitle} {daytodayText} 
    {regularText} {availableoptionsText} {regularwindowText} />

    <PromoProducts {featuredpromoTitle} {featuredpromoText} {featuredpromoBtn} {featuredpromoImage}/>

</Layout>
