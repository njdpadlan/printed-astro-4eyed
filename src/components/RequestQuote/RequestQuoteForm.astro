---
const {
    FullName,
    Email,
    Phone,
    CompanyName,
    ProductType,
    Quantity,
    FileUpload,
    AdditionalDetails,
    requestquoteBtn,
} = Astro.props;
---

<div class="form-card">
    <!-- Add https://formsubmit.co/email-here later in the action -->

    <div class="form-p">
        <p>Input fields that are marked with <span class="form-symbol">*</span> are required. </p>
     </div>
    <form
        action="#"
        method="post"
        name="requestquote"
        enctype="multipart/form-data"
    >
    <!-- Template type -->
    <input type="hidden" name="_template" value="table">
        <div>
            <label for={FullName}>{FullName} <span class="form-symbol">*</span></label>
            <input
                id={FullName}
                type="text"
                name="name"
                placeholder="Enter your full name here."
            />
            <p id="name_errormsg"></p>
        </div>
        <div>
            <label for="phone">{Phone} <span class="form-symbol">*</span></label>
            <input
                id="phone"
                type="number"
                name="phone"
                placeholder="Enter your phone number here."
            />
            <p id="phone_errormsg"></p>
        </div>
        <div>
            <label for={Email}>{Email}</label>
            <input
                id="email"
                name="email"
                placeholder="Enter your email address here."
            />
            <p id="email_errormsg"></p>
        </div>
        <div>
            <label for={CompanyName}>{CompanyName}</label>
            <input
                id={CompanyName}
                type="text"
                name="company"
                placeholder="Enter your company name here."
            />
        </div>
        <div class="product-type-quantity">
            
            <div>
                <label for="product-type">{ProductType} <span class="form-symbol">*</span></label>
                <select name="product_type" id="product-type">
                    <option value="">Choose a product</option>
                    <option value="Linerless Label">Linerless Label</option>
                    <option value="Pressure Seal">Pressure Seal Forms</option>
                    <option value="Integrated Form">Integrated Form/Labels</option>
                    <option value="Laser-Cut Sheet Form">Laser-Cut Sheet Forms</option>
                    <option value="Snapset Form">Snapset Form</option>
                    <option value="Continuous Form">Continuous Forms</option>
                    <option value="Custom Envelopes">Custom Envelopes</option>
                    <option value="Other">Other</option>
                </select>
                <p id="subject_errormsg"></p>
            </div>
            <div>
                <label for="quantity">{Quantity} <span class="form-symbol">*</span></label>
                <!-- <select name="quantity" id="quantity"> 
                    <option value="">Select Quantity</option>
                    <option value="10">10</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                    <option value="1000">1000</option>
                </select>
                -->
                   <input
                id={Quantity}
                type="number"
                name="quantity"
                placeholder="Enter your quantity here."
                />
                <p id="quantity_errormsg"></p>
            </div>
        </div>
        <div>
            <label class="label-upload" for={FileUpload}>{FileUpload}</label>
            <input
                id={FileUpload}
                class="file-upload"
                type="file"
                name="attachment"
                placeholder="Upload your file here."
            />
            <p class="upload-p">Upload a file up to 5MB.</p>
        </div>
        <div>
            <label for={AdditionalDetails}>{AdditionalDetails} <span class="form-symbol">*</span></label>
            <textarea
                id={AdditionalDetails}
                name="message"
                class="message-box"
                placeholder="Enter additional details here. Examples include sizes, materials, colours, specifications, questions, and details from file uploads."></textarea>
            <p id="message_errormsg"></p>
        </div>
        <input type="submit" value={requestquoteBtn} class="submit-btn" />
    </form>
</div>


<script>
  import { actions } from 'astro:actions';

  const form = document.querySelector('form');

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const nameErrorMsg = form.querySelector('#name_errormsg');
    const phoneErrorMsg = form.querySelector('#phone_errormsg');
    const emailErrorMsg = form.querySelector('#email_errormsg');
    const productTypeErrorMsg = form.querySelector('#subject_errormsg');
    const quantityErrorMsg = form.querySelector('#quantity_errormsg');
    const messageErrorMsg = form.querySelector('#message_errormsg');

    const formData = new FormData(form);
    const emailValue = formData.get('email')?.toString() || '';

    const { error } = await actions.submitRequestQuote(formData);
    console.log(error);
    let hasErrors = false;
    if (error && error.fields) {
    hasErrors = true;
    // Name
    nameErrorMsg.innerHTML = error.fields.name?.[0] || '';
    nameErrorMsg.style.display = nameErrorMsg.innerHTML ? 'inline' : 'none';

    // Phone
    phoneErrorMsg.innerHTML = error.fields.phone?.[0] || '';
    phoneErrorMsg.style.display = phoneErrorMsg.innerHTML ? 'inline' : 'none';

    // Message
    messageErrorMsg.innerHTML = error.fields.message?.[0] || '';
    messageErrorMsg.style.display = messageErrorMsg.innerHTML ? 'inline' : 'none';

    //Product Type
    productTypeErrorMsg.innerHTML = error.fields.product_type?.[0] || '';
    productTypeErrorMsg.style.display = productTypeErrorMsg.innerHTML ? 'inline' : 'none';

    //Quantity
    quantityErrorMsg.innerHTML = error.fields.quantity?.[0] || '';
    quantityErrorMsg.style.display = quantityErrorMsg.innerHTML ? 'inline' : 'none';


      if (emailValue.trim() !== '') {
        emailErrorMsg.innerHTML = error.fields.email?.[0] || '';
        emailErrorMsg.style.display = emailErrorMsg.innerHTML ? 'inline' : 'none';
      } else {
        emailErrorMsg.innerHTML = '';
        emailErrorMsg.style.display = 'none';
      }
    } else {
      // Hide all errors if no errors exist
      [nameErrorMsg, phoneErrorMsg, emailErrorMsg, productTypeErrorMsg, quantityErrorMsg, messageErrorMsg].forEach(
        (er) => {
          er.innerHTML = '';
          er.style.display = 'none';
        }
      );
    }
    if (!hasErrors) {
        form.submit();
    }
  });
</script>